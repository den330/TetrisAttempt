const canvasHeight=800,canvasWidth=600,cellSize=40,rows=canvasHeight/cellSize,cols=canvasWidth/cellSize;let pauseBtn=document.getElementById("pauseBtn"),gameSpeedLabel=document.getElementById("speedLabel");const speedIncreaseInterval=6e4;class Tetromino{x;y;shape;constructor(e){this.x=Math.floor(cols/2)-1,this.y=0,this.shape=e}}const Tetrominoes=[new Tetromino([[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]),new Tetromino([[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]),new Tetromino([[0,0,0,0],[0,1,0,0],[0,1,1,1],[0,0,0,0]]),new Tetromino([[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]]),new Tetromino([[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]]),new Tetromino([[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]),new Tetromino([[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]])];let boardArray;const canvas=document.getElementById("myCanvas"),nextShapeCanvas=document.getElementById("nextShapeCanvas"),nextShapeCanvasCtx=nextShapeCanvas.getContext("2d"),ctx=canvas.getContext("2d");let currentHighScore=0,currentScore=0,isGameOver=!0,currentTetromino,nextTeromino=Tetrominoes[Math.floor(Math.random()*Tetrominoes.length)];const score=document.getElementById("score"),highScore=document.getElementById("highScore");function updateGame(){if(null==currentTetromino){currentTetromino=nextTeromino;var e=Math.floor(Math.random()*Tetrominoes.length),r=Tetrominoes[e].shape;nextTeromino=new Tetromino(JSON.parse(JSON.stringify(r))),nextShapeCanvasCtx.clearRect(0,0,nextShapeCanvas.width,nextShapeCanvas.height),nextShapeCanvasCtx.fillStyle="#FFA500";for(var t=0;t<r.length;t++)for(var n=0;n<r[t].length;n++)0!=r[t][n]&&nextShapeCanvasCtx.fillRect(n*cellSize,t*cellSize,cellSize,cellSize)}let a=!0;for(t=0;t<currentTetromino.shape.length;t++)for(n=0;n<currentTetromino.shape[t].length;n++)if(0!=currentTetromino.shape[t][n]){var o=t+currentTetromino.y,i=n+currentTetromino.x;if(1==boardArray[o][i])return void endGame();(o+1>=rows||1==boardArray[o+1][i])&&(a=!1)}if(a)currentTetromino.y++;else{for(t=0;t<currentTetromino.shape.length;t++)for(var c,l,n=0;n<currentTetromino.shape[t].length;n++)0!=currentTetromino.shape[t][n]&&(c=t+currentTetromino.y,l=n+currentTetromino.x,boardArray[c][l]=1);let r=0;for(t=0;t<rows;t++){let e=!0;for(n=0;n<cols;n++)if(0==boardArray[t][n]){e=!1;break}e&&(boardArray.splice(t,1),boardArray.unshift(Array(cols).fill(0)),r+=1)}currentScore=10*r*r*gameSpeed+currentScore,score.innerText=currentScore,currentHighScore=Math.max(currentHighScore,currentScore),highScore.innerText=currentHighScore,currentTetromino=null}}function draw(){ctx.clearRect(0,0,canvasWidth,canvasHeight);for(var e=0;e<rows;e++)for(var r=0;r<cols;r++)1==boardArray[e][r]&&(ctx.fillStyle="#00FFFF",ctx.border="1px solid black",ctx.strokeRect(r*cellSize,e*cellSize,cellSize,cellSize),ctx.fillRect(r*cellSize,e*cellSize,cellSize,cellSize));if(null!=currentTetromino)for(e=0;e<currentTetromino.shape.length;e++)for(r=0;r<currentTetromino.shape[e].length;r++)0!=currentTetromino.shape[e][r]&&(ctx.fillStyle="#98FB98",ctx.fillRect((r+currentTetromino.x)*cellSize,(e+currentTetromino.y)*cellSize,cellSize,cellSize))}function checkRight(){for(var e=0;e<currentTetromino.shape.length;e++)for(var r=0;r<currentTetromino.shape[e].length;r++)if(0!=currentTetromino.shape[e][r]){var t=e+currentTetromino.y,n=r+currentTetromino.x;if(n+1>=cols||1==boardArray[t][n+1])return!1}return!0}function checkLeft(){for(var e=0;e<currentTetromino.shape.length;e++)for(var r=0;r<currentTetromino.shape[e].length;r++)if(0!=currentTetromino.shape[e][r]){var t=e+currentTetromino.y,n=r+currentTetromino.x;if(n-1<0||1==boardArray[t][n-1])return!1}return!0}function rotation(){var t=[];for(let r=0;r<currentTetromino.shape.length;r++){t.push([]);for(let e=0;e<currentTetromino.shape[r].length;e++)t[r][e]=currentTetromino.shape[e][r]}t.forEach(e=>e.reverse());var e,r;for([e,r]of[[0,0],[-1,0],[1,0],[0,-1]])if(isValidPosition(t,e,r))return currentTetromino.shape=t,currentTetromino.x+=e,void(currentTetromino.y+=r)}function isValidPosition(t,n,a){for(let r=0;r<t.length;r++)for(let e=0;e<t[r].length;e++)if(0!==t[r][e]){var o=currentTetromino.x+e+n,i=currentTetromino.y+r+a;if(o<0||o>=cols||i<0||i>=rows||1===boardArray[i][o])return!1}return!0}let updateGameInterval,drawInterval,speedInterval,handleKeyDown=function(e){"ArrowRight"===e.key&&checkRight()&&currentTetromino.x++,"ArrowLeft"===e.key&&checkLeft()&&currentTetromino.x--,"ArrowDown"==e.key&&(e.preventDefault(),updateGame()),"ArrowUp"==e.key&&(e.preventDefault(),rotation())};const title=document.getElementById("title"),startbutton=document.getElementById("startButton"),framePerSecond=24;let gameSpeed;function startGame(){isGameOver&&(isPaused=!1,pauseBtn.innerText="Pause",currentScore=0,score.innerText=currentScore,gameSpeed=1,gameSpeedLabel.innerText=gameSpeed,isGameOver=!1,boardArray=Array.from({length:rows},()=>Array(cols).fill(0)),currentTetromino=null,updateGameInterval=setInterval(()=>{updateGame()},1e3/gameSpeed),drawInterval=setInterval(()=>{draw()},1e3/framePerSecond),speedInterval=setInterval(increaseGameSpeed,speedIncreaseInterval),document.addEventListener("keydown",handleKeyDown),title.innerText="Tetris",startbutton.innerText="Restart Game",pauseBtn.classList.remove("hidden"))}function endGame(){clearInterval(updateGameInterval),clearInterval(drawInterval),clearInterval(speedInterval),document.removeEventListener("keydown",handleKeyDown),isGameOver=!0,title.innerText="Game Over",startbutton.innerText="Start Game",pauseBtn.classList.add("hidden")}function restartGame(){endGame(),startGame()}function handleGame(){(isGameOver?startGame:restartGame)()}startbutton.addEventListener("click",handleGame);let isPaused=!1;function togglePause(){isGameOver||(isPaused=!isPaused,pauseBtn.innerText=isPaused?"Resume":"Pause",isPaused?(clearInterval(updateGameInterval),clearInterval(drawInterval),document.removeEventListener("keydown",handleKeyDown),title.innerText="Game Paused"):(updateGameInterval=setInterval(()=>{updateGame()},1e3/gameSpeed),drawInterval=setInterval(()=>{draw()},1e3/framePerSecond),document.addEventListener("keydown",handleKeyDown),title.innerText="Tetris"))}function increaseGameSpeed(){isGameOver||isPaused||12<=gameSpeed||(gameSpeed+=1,gameSpeedLabel.innerText=gameSpeed,clearInterval(updateGameInterval),updateGameInterval=setInterval(updateGame,1e3/gameSpeed))}pauseBtn.addEventListener("click",togglePause),document.addEventListener("DOMContentLoaded",function(){pauseBtn.classList.add("hidden")});